[gd_scene load_steps=13 format=3 uid="uid://6c3twc7vahyg"]

[ext_resource type="Script" path="res://Movement.cs" id="1_7cxid"]
[ext_resource type="Script" path="res://LidarGun.cs" id="2_b5f03"]
[ext_resource type="Script" path="res://PointCloud.cs" id="3_k48ic"]
[ext_resource type="Material" uid="uid://by2ixjnad8njj" path="res://GlowMaterial.tres" id="5_u8h3k"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_vbrmc"]
sky_top_color = Color(0, 0, 0, 1)
sky_horizon_color = Color(0.5, 0.5, 0.5, 1)
sky_energy_multiplier = 0.0
ground_bottom_color = Color(0, 0, 0, 1)
ground_horizon_color = Color(0.5, 0.5, 0.5, 1)

[sub_resource type="Sky" id="Sky_2y0mi"]
sky_material = SubResource("ProceduralSkyMaterial_vbrmc")

[sub_resource type="Environment" id="Environment_xnj55"]
background_color = Color(0.212305, 0.212305, 0.212305, 1)
background_energy_multiplier = 0.0
sky = SubResource("Sky_2y0mi")
ambient_light_source = 1
ambient_light_color = Color(1, 1, 1, 1)
ambient_light_energy = 0.37
tonemap_mode = 2
glow_enabled = true
glow_intensity = 2.0
glow_bloom = 0.7

[sub_resource type="Shader" id="Shader_o2tnt"]
code = "// NOTE: Shader automatically converted from Godot Engine 4.3.stable.mono's StandardMaterial3D.

shader_type spatial;
render_mode blend_mix, depth_draw_never, cull_back, depth_test_disabled, shadows_disabled;

uniform vec4 albedo : source_color;

uniform float distance_fade_min : hint_range(0.0, 4096.0, 0.01);
uniform float distance_fade_max : hint_range(0.0, 4096.0, 0.01);
uniform float point_size : hint_range(0.1, 128.0, 0.1);

uniform float emission_energy : hint_range(0.0, 100.0, 0.01);

void vertex() {
	// Use Point Size: Enabled
	POINT_SIZE = point_size;

	// Billboard Mode: Particles
	mat4 mat_world = mat4(
			normalize(INV_VIEW_MATRIX[0]),
			normalize(INV_VIEW_MATRIX[1]),
			normalize(INV_VIEW_MATRIX[2]),
			MODEL_MATRIX[3]);
	mat_world = mat_world * mat4(
			vec4(cos(INSTANCE_CUSTOM.x), -sin(INSTANCE_CUSTOM.x), 0.0, 0.0),
			vec4(sin(INSTANCE_CUSTOM.x), cos(INSTANCE_CUSTOM.x), 0.0, 0.0),
			vec4(0.0, 0.0, 1.0, 0.0),
			vec4(0.0, 0.0, 0.0, 1.0));
	MODELVIEW_MATRIX = VIEW_MATRIX * mat_world;

	MODELVIEW_NORMAL_MATRIX = mat3(MODELVIEW_MATRIX);
}

void fragment() {
	vec2 base_uv = UV;
	
	ALBEDO = albedo.rgb;

	// Emission Operator: Add
	EMISSION = COLOR.rgb * emission_energy;
	ALPHA *= albedo.a;

	// Distance Fade: Pixel Alpha
	ALPHA *= clamp(smoothstep(distance_fade_min, distance_fade_max, length(VERTEX)), 0.0, 1.0);
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ga23s"]
render_priority = 0
shader = SubResource("Shader_o2tnt")
shader_parameter/albedo = Color(0.388235, 0.184314, 0.388235, 1)
shader_parameter/distance_fade_min = 25.0
shader_parameter/distance_fade_max = 0.0
shader_parameter/point_size = 2.0
shader_parameter/emission_energy = 1.0

[sub_resource type="PointMesh" id="PointMesh_7aeqw"]
material = SubResource("ShaderMaterial_ga23s")

[sub_resource type="MultiMesh" id="MultiMesh_mthw8"]
transform_format = 1
use_colors = true
mesh = SubResource("PointMesh_7aeqw")

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_1eb2w"]

[node name="Node3D" type="Node3D"]

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.866023, -0.433016, 0.250001, 0, 0.499998, 0.866027, -0.500003, 0.749999, -0.43301, 0, 0, 0)
visible = false
light_energy = 0.3
shadow_enabled = true

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_xnj55")

[node name="PointCloud" type="MultiMeshInstance3D" parent="."]
gi_mode = 0
multimesh = SubResource("MultiMesh_mthw8")
script = ExtResource("3_k48ic")

[node name="Enviroment" type="Node" parent="."]

[node name="CSGBox3D2" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.5, 0.5, -4)
gi_mode = 0
use_collision = true
size = Vector3(4, 2, 1)

[node name="CSGBox3D3" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(0.258819, 0, -0.965926, 0, 1, 0, 0.965926, 0, 0.258819, -4.5, 0.5, 1)
gi_mode = 0
use_collision = true
size = Vector3(4, 2, 1)

[node name="CSGBox3D4" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(-0.866025, 0, -0.5, 0, 1, 0, 0.5, 0, -0.866025, 9.5, 0.5, -4)
gi_mode = 0
use_collision = true
size = Vector3(4, 2, 1)

[node name="Wall" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 3, -16, -0.093995, 0)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 4, 11)

[node name="Wall2" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 3, 15, 0, 0)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 2.18799, 11)

[node name="Wall3" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(-4.37114e-08, 0, 3, 0, 1, 0, -1, 0, -1.31134e-07, 0, 0, 15)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 2.18799, 11)

[node name="Wall5" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(-0.707107, 0, 2.12132, 0, 1, 0, -0.707107, 0, -2.12132, 6, 0, 5)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 2.18799, 11)

[node name="Wall4" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(-4.37114e-08, 0, 3, 0, 1, 0, -1, 0, -1.31134e-07, 0, 0, -15)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 2.18799, 11)

[node name="GroundPlane" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(30.3193, 0, 0, 0, 0.0654485, 0, 0, 0, 30.3193, 0, -0.508438, 0)
use_collision = true

[node name="Wall6" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 3, -41, 3, 0)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 2.18799, 11)

[node name="Wall7" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(-0.258819, -1.13133e-08, -2.89778, -0.965926, -4.2222e-08, 0.776457, -4.37114e-08, 1, -5.2108e-15, -11.1533, 0.835314, 12)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 2.18799, 5)

[node name="Wall8" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(-4.37114e-08, 0, 3, 0, 1, 0, -1, 0, -1.31134e-07, -31, 3, 15)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 2.18799, 11)

[node name="Wall10" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(-4.37114e-08, 0, 3, 0, 1, 0, -1, 0, -1.31134e-07, -31, 3, -15)
gi_mode = 0
calculate_tangents = false
use_collision = true
size = Vector3(1, 2.18799, 11)

[node name="GroundPlane2" type="CSGBox3D" parent="Enviroment"]
transform = Transform3D(30.3193, 0, 0, 0, 0.0654485, 0, 0, 0, 30.3193, -31, 2.49156, 0)
use_collision = true

[node name="CharacterBody3D" type="CharacterBody3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1.59859)
script = ExtResource("1_7cxid")

[node name="CollisionShape3D" type="CollisionShape3D" parent="CharacterBody3D"]
shape = SubResource("CapsuleShape3D_1eb2w")

[node name="Camera3D" type="Camera3D" parent="CharacterBody3D"]
transform = Transform3D(1, 0, 0, 0, 0.79653, 0.604599, 0, -0.604599, 0.79653, 0, 1, 0)
current = true

[node name="LidarGun" type="Node3D" parent="CharacterBody3D/Camera3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.385, -0.17488, -0.605554)
script = ExtResource("2_b5f03")

[node name="CSGSphere3D" type="CSGSphere3D" parent="CharacterBody3D/Camera3D/LidarGun"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.12)
calculate_tangents = false
radius = 0.05
smooth_faces = false
material = ExtResource("5_u8h3k")

[node name="CSGCylinder3D" type="CSGCylinder3D" parent="CharacterBody3D/Camera3D/LidarGun"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
calculate_tangents = false
radius = 0.103
height = 0.317
cone = true
smooth_faces = false
material = ExtResource("5_u8h3k")

[node name="Door" type="CSGBox3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5, 1, 0.5)
calculate_tangents = false
use_collision = true
size = Vector3(1, 3, 2)
metadata/pointColor = Color(0, 1, 0, 1)
